# Automated Vulnerability Results Report Action

## Description

An action to create a CSV report for the following security testing tools based on their JSON reports.

**General Notes:**
- The action will only create a CSV report if the JSON report exists.
- Scanning of each available security tool is optional, and is dependent on Workflow inputs supplied.

**API Key Notes:**
- SonarQube API requires a User Token. See [SonarQube Documentation](https://docs.sonarsource.com/sonarqube/9.9/user-guide/user-account/generating-and-using-tokens/) for more information.
- DeepSource API requires an API Key. See [DeepSource Documentation](https://docs.deepsource.com/docs/api) for more information.

**API Rate Limiting Notes:**
- The action uses the NVD API to acquire additional information about CVE vulnerabilities for SCA reports.
    - NVD API is rate limited to 50 requests in a rolling 30 second window. The action caches CVE details to reduce the number of requests made.
- The action uses the OpenCVE API to acquire additional information about CWE vulnerabilities for SAST reports.
  - OpenCVE API is rate limited to 100 requests per minute. The action caches CWE details to reduce the number of requests made.

**GitHub Notes:**
- The action uses the GitHub API to acquire CodeQL results.
  - OAuth app tokens and personal access tokens need the `security_events` scope for private or public repositories, or the `public_repo` scope for public repositories only.
- The action requires Dependabot alerts to enabled in the repository to generate Dependabot CSV reports.
  - There is no CLI available to generate Dependabot JSON reports, and functionality is embedded in the GitHub UI.

## Supported Security Testing Tools

| Security Testing Tool Type | Security Testing Tool Name |
|----------------------------|----------------------------|
| SAST                       | CodeQL                     |
| SAST                       | DeepSource                 |
| SAST                       | Horusec                    |
| SAST                       | Semgrep                    |
| SAST                       | Snyk Code                  |
| SAST                       | SonarQube                  |
| SCA                        | Dependabot                 |
| SCA                        | Eclipse Steady             |
| SCA                        | Grype                      |
| SCA                        | Snyk                       |
| SCA                        | OWASP Dependency Check     |

## Inputs

| name                                               | required | type   | default                                             | description                                         |
|----------------------------------------------------|----------|--------|-----------------------------------------------------|-----------------------------------------------------|
| **nvd-api-key**                                    | true     | string |                                                     | API Key to access the NVD API                       |
| **github-server-url**                              | false    | string | ${{ github.server_url }}                            | GitHub server URL                                   |
| **github-api-url**                                 | false    | string | ${{ github.api_url }}                               | GitHub API URL                                      |
| **github-api-token**                               | true     | string |                                                     | Token to access the GitHub API                      |
| **opencve-username**                               | true     | string |                                                     | Username to query OpenCVE API                       |
| **opencve-password**                               | true     | string |                                                     | Password to query OpenCVE API                       |
| **experiment-id**                                  | true     | string |                                                     | Experiment ID                                       |
| **experiment-github-project-name**                 | true     | string |                                                     | Name of the project being evaluated                 |"
| **experiment-github-repository**                   | false    | string | ${{ github.repository }}                            | Repository name in GitHub (owner/repository)        |
| **experiment-github-branch**                       | false    | string | ${{ github.ref_name }}                              | Branch name in GitHub                               |
| **experiment-github-commit**                       | false    | string | ${{ github.sha }}                                   | Commit SHA in GitHub                                |
| **experiment-github-workflow-name**                | false    | string | ${{ github.workflow }}                              | Workflow name in GitHub                             |
| **experiment-github-workflow-run-id**              | false    | string | ${{ github.run_id }}                                | Workflow run in GitHub                              |
| **experiment-programming-language**                | true     | string |                                                     | Programming language of the project being evaluated |
| **sonarqube-url**                                  | false    | string |                                                     | Hostname of SonarQube                               |
| **sonarqube-user-token**                           | false    | string |                                                     | User token for querying SonarQube API               |
| **sonarqube-project-key**                          | false    | string |                                                     | Project key being scanned by SonarQube              |
| **deepsource-api-key**                             | false    | string |                                                     | API Key to access DeepSource API                    |
| **sast-codeql-csv-result-filename**                | false    | string | sast-codeql-vulnerability-result.csv                | Name of CodeQL CSV result filename                  |
| **sast-deepsource-csv-result-filename**            | false    | string | sast-deepsource-vulnerability-result.csv            | Name of DeepSource CSV result filename              |
| **sast-horusec-report-filename**                   | false    | string |                                                     | Name of Horusec report filename                     |
| **sast-horusec-csv-result-filename**               | false    | string | sast-horusec-vulnerability-result.csv               | Name of Horusec CSV result filename                 |
| **sast-semgrep-report-filename**                   | false    | string |                                                     | Name of Semgrep report filename                     |
| **sast-semgrep-csv-result-filename**               | false    | string | sast-semgrep-vulnerability-result.csv               | Name of Semgrep CSV result filename                 |
| **sast-snyk-code-report-filename**                 | false    | string |                                                     | Name of Snyk Code report filename                   |
| **sast-snyk-code-csv-result-filename**             | false    | string | sast-snyk-code-vulnerability-result.csv             | Name of Snyk Code CSV result filename               |
| **sast-sonarqube-csv-result-filename**             | false    | string | sast-sonarqube-vulnerability-result.csv             | Name of SonarQube CSV result filename               |
| **sca-dependabot-csv-result-filename**             | false    | string | sca-dependabot-vulnerability-result.csv             | Name of Dependabot CSV result filename              |
| **sca-eclipse-steady-report-filename**             | false    | string |                                                     | Name of Eclipse Steady report filename              |
| **sca-eclipse-steady-csv-result-filename**         | false    | string | sca-eclipse-steady-vulnerability-result.csv         | Name of Eclipse Steady CSV result filename          |
| **sca-grype-report-filename**                      | false    | string |                                                     | Name of Grype report filename                       |
| **sca-grype-csv-result-filename**                  | false    | string | sca-grype-vulnerability-result.csv                  | Name of Grype CSV result filename                   |
| **sca-snyk-report-filename**                       | false    | string |                                                     | Name of Snyk report filename                        |
| **sca-snyk-csv-result-filename**                   | false    | string | sca-snyk-vulnerability-result.csv                   | Name of Snyk CSV result filename                    |
| **sca-owasp-dependency-check-report-filename**     | false    | string |                                                     | Name of OWASP Dependency Check report filename      |
| **sca-owasp-dependency-check-csv-result-filename** | false    | string | sca-owasp-dependency-check-vulnerability-result.csv | Name of OWASP Dependency Check CSV result filename  |
| **artifact-name**                                  | false    | string | automated-vulnerability-results-report              | Name of the artifact to upload                      |
| **include-unit-tests**                             | false    | string | false                                               | Whether to run action unit tests                    |

## Build Artifacts

The following build artifact is uploaded to the GitHub Actions workflow run. This can be changed using the `artifact-name` input.
- `automated-vulnerability-results-report`

## Example Execution

```yaml
- name: Create Automated Vulnerability Results Report
  uses: seansmith2600/H6060-Experiment-Resources/.github/actions/reporting/vulnerability-results-report/automated@main
  with:
    nvd-api-key: 11111111-2222-3333-4444-555555555555
    github-api-token: ${{ secrets.GITHUB_API_TOKEN }}
    opencve-username: my-username
    opencve-password: my-password
    experiment-id: 1
    experiment-github-project-name: my-project
    experiment-programming-language: java
    sonarqube-url: https://my-sonarqube-instance.com
    sonarqube-token: my-token
    sonarqube-project-key: my-project
    deepsource-api-key: my-api-key
    sast-horusec-report-filename: sast-horusec-report/horusec-report.json
    sast-semgrep-report-filename: sast-semgrep-report/semgrep-report.json
    sast-snyk-code-report-filename: sast-snyk-code-report/snyk-code-report.json
    sca-eclipse-steady-report-filename: sca-eclipse-steady-report/eclipse-steady-report.json
    sca-grype-report-filename: sca-grype-report/grype-report.json
    sca-snyk-report-filename: sca-snyk-report/snyk-report.json
    sca-owasp-dependency-check-report-filename: sca-owasp-dependency-check-report/owasp-dependency-check-report.json
```

## Action Unit Tests

To run the action unit tests, set the `include-unit-tests` input to `true`.

## CSV Report

A combined report is generated in the root directory of the repository based on the security testing tool category (SCA or SAST) and is uploaded as a build artifact.
- An individual report is also generated in the root directory of the repository for each security testing tool and is uploaded as a build artifact.

The generated reports contain the following columns.

### SAST Reports

| Name                                      | Description                                        | 
|-------------------------------------------|----------------------------------------------------|
| **Experiment ID**                         | Experiment Number                                  |
| **Experiment Date**                       | Date of experiment execution                       |
| **Experiment Project Name**               | Name of project being evaluated                    |
| **Experiment Upstream GitHub Repository** | URL of upstream GitHub repository                  |
| **Experiment GitHub Repository**          | URL of forked GitHub repository                    |
| **Experiment GitHub Branch**              | Branch of forked GitHub repository                 |
| **Experiment GitHub Commit**              | Commit SHA of forked GitHub repository             |
| **Experiment GitHub Workflow Name**       | Name of experiment GitHub workflow                 |
| **Experiment GitHub Workflow Run**        | URL of experiment GitHub workflow run              |
| **Security Testing Tool Category**        | Category of security testing tool                  |
| **Security Testing Tool Type**            | Type of security testing tool                      |               
| **Security Testing Tool Name**            | Name of security testing tool                      |    
| **Security Testing Tool Classification**  | Classification of security testing tool            |       
| **Security Testing Tool CLI Version**     | CLI version of security testing tool               |
| **Programming Language**                  | Programming language associated with vulnerability |
| **Severity**                              | Severity of reported vulnerability                 |
| **Confidence**                            | Confidence of vulnerability accuracy               |
| **CWE ID**                                | CWE ID                                             |
| **CWE Name**                              | CWE Name                                           |
| **CWE Description**                       | CWE Description                                    |
| **CWE Impact**                            | Impact rating of CWE                               |
| **CWE Likelihood**                        | Likelihood of CWE exploitation                     |
| **OWASP Top 10**                          | Category of OWASP top 10 for CWE ID                |
| **MITRE Top 25**                          | Index of MITRE top 25 for CWE ID                   |
| **Rule ID**                               | Rule id associated with vulnerability              |
| **File**                                  | File associated with vulnerability                 |
| **Line**                                  | Line number associated with vulnerability          |

### SCA Reports

| Name                                       | Description                                            | 
|--------------------------------------------|--------------------------------------------------------|
| **Experiment ID**                          | Experiment Number                                      |
| **Experiment Date**                        | Date of experiment execution                           |
| **Experiment Project Name**                | Name of project being evaluated                        |
| **Experiment Upstream GitHub Repository**  | URL of upstream GitHub repository                      |
| **Experiment Forked GitHub Repository**    | URL of forked GitHub repository                        |
| **Experiment Forked GitHub Branch**        | Branch of forked GitHub repository                     |
| **Experiment Forked GitHub Commit**        | Commit SHA of forked GitHub repository                 |
| **Experiment Forked GitHub Workflow Name** | Name of experiment GitHub workflow                     |
| **Experiment Forked GitHub Workflow Run**  | URL of experiment GitHub workflow run                  |
| **Security Testing Tool Category**         | Category of security testing tool                      |
| **Security Testing Tool Type**             | Type of security testing tool                          |               
| **Security Testing Tool Name**             | Name of security testing tool                          |    
| **Security Testing Tool Classification**   | Classification of security testing tool                |       
| **Security Testing Tool CLI Version**      | CLI version of security testing tool                   |
| **Programming Language**                   | Programming language associated with vulnerability     |
| **Severity**                               | Severity of reported vulnerability                     |
| **Confidence**                             | Confidence of vulnerability accuracy                   |
| **Component Type**                         | Type of component associated with vulnerability        |
| **Component Name**                         | Name of component associated with vulnerability        |
| **Component Version**                      | Version of component associated with vulnerability     |
| **Component PURL**                         | Package URL of component associated with vulnerability |
| **Component License**                      | License of component associated with vulnerability     |
| **Component Location**                     | Location of component associated with vulnerability    |
| **CVE ID**                                 | CWE ID                                                 |
| **CVE Description**                        | CVE description                                        |
| **CVE Source**                             | Organisation who reported CVE                          |
| **CVE Published Date**                     | Date CVE was published                                 |
| **CVE Last Modified Date**                 | Date CVE was last modified                             |
| **CVE Status**                             | Current status of vulnerability                        |
| **CVE Malicious**                          | Whether CVE is malicious                               |
| **CVE Disputed**                           | Whether CVE is disputed                                |
| **CVSS V2 Vector**                         | CVSS V2 metrics                                        |
| **CVSS V3 Vector**                         | CVSS V3.1 or V3 metrics                                |
| **CVSS V4 Vector**                         | CVSS V2 metrics                                        |
| **CWE ID**                                 | CWE ID                                                 |

## Resources

- [NVD API](https://csrc.nist.gov/Projects/Security-Content-Automation-Protocol/specifications/nvd)
- [OpenCVE API](https://opencve.io/docs)
- [GitHub API](https://docs.github.com/en/rest)
- [CodeQL](https://securitylab.github.com/tools/codeql)
- [DeepSource](https://docs.deepsource.com/docs/introduction)
- [Horusec](https://horusec.io/)
- [Semgrep](https://semgrep.dev/)
- [Snyk Code](https://snyk.io/product/snyk-code/)
- [SonarQube](https://www.sonarqube.org/)
- [Dependabot](https://dependabot.com/)
- [Eclipse Steady](https://www.eclipse.org/steady/)
- [Grype](https://github.com/anchore/grype)
- [Snyk](https://snyk.io/)
- [OWASP Dependency Check](https://owasp.org/www-project-dependency-check/)
